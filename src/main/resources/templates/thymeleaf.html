<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MOCK MOCKER</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body style="margin-top: 0">

<div id="app">
    <!-- 导航-->
    <el-row :gutter="20">
        <el-menu class="el-menu-demo" mode="horizontal" background-color="#409eff">

            <el-menu-item index="1">
                <span style="color: #ffffff;font-size: 30px">MOCK MOCKER<span
                        style="font-size: 9px">v0.01</span></span>
            </el-menu-item>
        </el-menu>
    </el-row>

    <!-- 内容-->
    <el-row :gutter="20">
<!--        左侧时间线-->
        <el-col :span="4">
            <br>
            <br>
            <el-timeline>
                <el-timeline-item
                        v-for="(activity, index) in activities"
                        :key="index"
                        :icon="activity.icon"
                        :type="activity.type"
                        :color="activity.color"
                        :size="activity.size"
                        :timestamp="activity.timestamp">
                    {{activity.content}}
                </el-timeline-item>
            </el-timeline>
        </el-col>
<!--        中间-->
        <el-col :span="20">
            <br>
            <el-row>
                <el-col :span="4">
                    <el-button type="text" @click="showInsertDialog()">点击创建一个mock url</el-button>
                </el-col>
                <el-col :span="16">
                    <el-input class="search_input"
                              placeholder="请输入内容"
                              v-model="search_input"
                              style="border-radius:16px 0px 0px 16px">
                    </el-input>
                </el-col>
                <el-col :span="4">
                    <el-button  @click="qryMockList()" class="search_button" type="primary" icon="el-icon-search">搜索</el-button>
                </el-col>

                <el-dialog title="MOCK URL" :visible.sync="dialogInsertMockFormVisible">
                    <el-form ref="addForm" :rules="rules" :model="addForm" label-width="80px">
                        <el-form-item label="接口名称" prop="interfaceName">
                            <el-input v-model="addForm.interfaceName"></el-input>
                        </el-form-item>
                        <el-form-item label="接口地址" prop="address">
                            <el-input v-model="addForm.address"></el-input>
                        </el-form-item>
                        <el-form-item label="请求方式" prop="method">
                            <el-checkbox-group v-model="addForm.method">
                                <el-checkbox label="HEAD" name="method"></el-checkbox>
                                <el-checkbox label="GET" name="method"></el-checkbox>
                                <el-checkbox label="POST" name="method"></el-checkbox>
                                <el-checkbox label="PUT" name="method"></el-checkbox>
                                <el-checkbox label="PATCH" name="method"></el-checkbox>
                                <el-checkbox label="DELETE" name="method"></el-checkbox>
                                <el-checkbox label="OPTIONS" name="method"></el-checkbox>
                                <el-checkbox label="TRACE" name="method"></el-checkbox>
                            </el-checkbox-group>
                        </el-form-item>
                        <el-form-item label="参数类型" prop="requestType">
                            <el-checkbox-group v-model="addForm.requestType">
                                <el-checkbox label="application/x-www-form-urlencoded" name="requestType"></el-checkbox>
                                <el-checkbox label="application/json" name="requestType"></el-checkbox>
                                <el-checkbox label="application/atom+xml" name="requestType"></el-checkbox>
                                <el-checkbox label="application/cbor" name="requestType"></el-checkbox>
                                <el-checkbox label="application/json;charset=UTF-8" name="requestType"></el-checkbox>
                                <el-checkbox label="application/octet-stream" name="requestType"></el-checkbox>
                                <el-checkbox label="application/pdf" name="requestType"></el-checkbox>
                                <el-checkbox label="application/problem+json" name="requestType"></el-checkbox>
                                <el-checkbox label="application/problem+json;charset=UTF-8" name="requestType"></el-checkbox>
                                <el-checkbox label="application/problem+xml" name="requestType"></el-checkbox>
                                <el-checkbox label="application/rss+xml" name="requestType"></el-checkbox>
                                <el-checkbox label="application/x-ndjson" name="requestType"></el-checkbox>
                                <el-checkbox label="application/stream+json" name="requestType"></el-checkbox>
                                <el-checkbox label="application/xhtml+xml" name="requestType"></el-checkbox>
                                <el-checkbox label="application/xml" name="requestType"></el-checkbox>
                                <el-checkbox label="image/gif" name="requestType"></el-checkbox>
                                <el-checkbox label="image/jpeg" name="requestType"></el-checkbox>
                                <el-checkbox label="image/png" name="requestType"></el-checkbox>
                                <el-checkbox label="multipart/form-data" name="requestType"></el-checkbox>
                                <el-checkbox label="multipart/mixed" name="requestType"></el-checkbox>
                                <el-checkbox label="multipart/related" name="requestType"></el-checkbox>
                                <el-checkbox label="text/event-stream" name="requestType"></el-checkbox>
                                <el-checkbox label="text/html" name="requestType"></el-checkbox>
                                <el-checkbox label="text/markdown" name="requestType"></el-checkbox>
                                <el-checkbox label="text/plain" name="requestType"></el-checkbox>
                                <el-checkbox label="text/xml" name="requestType"></el-checkbox>

                            </el-checkbox-group>
                        </el-form-item>
                        <el-form-item label="返回类型" prop="responseType">
                            <el-radio-group v-model="addForm.responseType">
                                <el-radio label="application/x-www-form-urlencoded" ></el-radio>
                                <el-radio label="application/json" ></el-radio>
                                <el-radio label="application/atom+xml" ></el-radio>
                                <el-radio label="application/cbor" ></el-radio>
                                <el-radio label="application/json;charset=UTF-8" ></el-radio>
                                <el-radio label="application/octet-stream" ></el-radio>
                                <el-radio label="application/pdf" ></el-radio>
                                <el-radio label="application/problem+json" ></el-radio>
                                <el-radio label="application/problem+json;charset=UTF-8" ></el-radio>
                                <el-radio label="application/problem+xml" ></el-radio>
                                <el-radio label="application/rss+xml" ></el-radio>
                                <el-radio label="application/x-ndjson" ></el-radio>
                                <el-radio label="application/stream+json" ></el-radio>
                                <el-radio label="application/xhtml+xml" ></el-radio>
                                <el-radio label="application/xml" ></el-radio>
                                <el-radio label="image/gif" ></el-radio>
                                <el-radio label="image/jpeg" ></el-radio>
                                <el-radio label="image/png" ></el-radio>
                                <el-radio label="multipart/form-data" ></el-radio>
                                <el-radio label="multipart/mixed" ></el-radio>
                                <el-radio label="multipart/related" ></el-radio>
                                <el-radio label="text/event-stream" ></el-radio>
                                <el-radio label="text/html" ></el-radio>
                                <el-radio label="text/markdown" ></el-radio>
                                <el-radio label="text/plain" ></el-radio>
                                <el-radio label="text/xml" ></el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="返回内容" prop="response">
                            <el-input type="textarea" v-model="addForm.response"></el-input>
                        </el-form-item>
                    </el-form>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="dialogInsertMockFormVisible = false">取 消</el-button>
                        <el-button type="primary" @click="addMockerInfo()"  v-if="isUpdateButton == 1">立即创建</el-button>
                        <el-button type="primary" @click="updateMockerInfo()" v-if="isUpdateButton == 2">修改</el-button>
                    </div>
                </el-dialog>
            </el-row>
            <el-row>
                <el-table
                        :data="tableData"
                        stripe
                        style="width: 100%">
                    <el-table-column
                            prop="id"
                            label="id"
                            width="60">
                    </el-table-column>
                    <el-table-column
                            prop="name"
                            label="接口名称"
                            width="80">
                    </el-table-column>
                    <el-table-column
                            prop="requestMethod"
                            label="请求方式"
                            width="100">
                    </el-table-column>
<!--                    <el-table-column-->
<!--                            prop="requestType"-->
<!--                            label="请求类型"-->
<!--                            width="80">-->
<!--                    </el-table-column>-->
<!--                    <el-table-column-->
<!--                            prop="responseType"-->
<!--                            label="返回类型"-->
<!--                            width="80">-->
<!--                    </el-table-column>-->
                    <el-table-column
                            label="返回值"
                            width="80">
                        <template slot-scope="scope">
                            <el-popover trigger="click" placement="top">
                                <p>{{ scope.row.response }}</p>
                                <el-button type="text" slot="reference" class="name-wrapper">
                                    接口内容
                                </el-button>
                            </el-popover>
                        </template>
                    </el-table-column>

                    <el-table-column
                            prop="address"
                            label="mock地址"
                            width="200"
                    >
                    </el-table-column>
                    <el-table-column
                            prop="realUri"
                            label="调用地址"
                    ></el-table-column>
                    <el-table-column
                            prop="createDate"
                            label="创建时间"
                            width="200">
                    </el-table-column>
                    <el-table-column label="操作" width="140">
                        <template slot-scope="scope">
                            <el-button @click="showInfoDialog(scope.row.id)" type="text" size="small">查看</el-button>
                            <el-button @click="showUpdateDialog(scope.row.id)" type="text" size="small">编辑</el-button>
                            <el-button @click="deleteMockerInfo(scope.row.id)" type="text" size="small">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </el-row>
            <el-dialog title="MOCK INFO" :visible.sync="dialogMockInfoFormVisible">
                <el-card class="box-card">
                    <div class="text item">
                        接口名称：{{mockInfo.interfaceName}}
                    </div>
                    <div class="text item">
                        接口地址：{{mockInfo.address}}
                    </div>
                    <div class="text item">
                        创建时间：{{mockInfo.createDate}}
                    </div>
                </el-card>

                <el-table
                        :data="callLogData"
                        stripe
                        style="width: 100%">
                    <el-table-column
                            prop="id"
                            label="id"
                            width="60">
                    </el-table-column>
                    <el-table-column
                            prop="callDate"
                            label="调用时间"
                    >
                    </el-table-column>
                    <el-table-column
                            prop="callerIp"
                            label="mock地址"
                    >
                    </el-table-column>
                </el-table>
            </el-dialog>
        </el-col>
    </el-row>
    <!--    footer-->
    <el-row :gutter="20">
    </el-row>
</div>
<style>
    .search_input input.el-input__inner {
        border-radius: 16px 0px 0px 16px;
    }

    .search_button {
        border-radius: 0px 16px 16px 0px;
        border: 0.8px solid #409EFF;
    }

</style>

</body>

<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                tableData: [],
                callLogData:[],
                dialogInsertMockFormVisible: false,
                dialogMockInfoFormVisible: false,
                addForm: {
                    interfaceId: null,
                    interfaceName: '',
                    address: '',
                    method: [],
                    requestType: [],
                    responseType: '',
                    response: ''
                },
                mockInfo: {
                    interfaceName: '',
                    address: '',
                    method: [],
                    requestType: [],
                    responseType: '',
                    response: '',
                    createDate: ''
                },
                reverse: true,
                activities: [{
                    content: '页面开发完成',
                    timestamp: '2021-05-08 21:25',
                    size: 'large',
                    type: 'primary',
                    icon: 'el-icon-sunny'
                }, {
                    content: '后台服务支持',
                    timestamp: '2021-05-08 23:25',
                    color: '#0bbd87'
                }, {
                    content: 'API管理',
                    timestamp: '2099-04-03 20:46',
                    size: 'large'
                }, {
                    content: '请求参数校验',
                    timestamp: '2099-04-03 20:46'
                },{
                    content: '动态返回参数',
                    timestamp: '2099-04-03 20:46'
                },{
                    content: '租户管理',
                    timestamp: '2099-04-03 20:46'
                },{
                    content: '谢绝白嫖',
                    timestamp: '2099-04-03 20:46'
                }],
                search_input: "",
                rules: {
                    interfaceName: [
                        {required: true, message: '请输入接口名称', trigger: 'blur'},
                        {min: 2, max: 10, message: '长度在 2 到 10 个字符', trigger: 'blur'}
                    ],
                    address: [
                        {required: true, message: '请输入接口地址', trigger: 'blur'},
                        {min: 2, max: 50, message: '长度在 2 到 50 个字符', trigger: 'blur'}
                    ],
                    method: [
                        {type: 'array', required: true, message: '请至少选择一个请求方式', trigger: 'change'}
                    ],
                    requestType: [
                        {type: 'array', required: true, message: '请至少选择一个请求方式', trigger: 'change'}
                    ],
                    responseType: [
                        {required: true, message: '请选择返回类型', trigger: 'change'}
                    ],
                    response: [
                        {required: false, message: '请输入返回内容', trigger: 'blur'},
                    ]
                },
                isUpdateButton: 1
            };
        },
        mounted() {
            this.qryMockList()
        },
        created() {

        },
        methods: {
            next: function (step) {
            },
            qryMockList() {
                const mockList = []
                axios.request({
                    url: '/interface',
                    method: 'GET',
                    params: {
                        'urlPath':this.search_input
                    }
                }).then(response => {
                    response.data.forEach(info => {
                        mockList.push({
                            "id": info.interfaceId,
                            "name": info.interfaceName,
                            "address": info.urlPath,
                            "createDate": info.createDate,
                            "response": info.responseBody,
                            "responseType": info.responseContextType,
                            "requestType": info.requestContextType,
                            "requestMethod": info.requestMethod,
                            "realUri": info.realUri,
                        })
                    })
                    this.tableData = mockList;
                })
            },
            showInsertDialog(){
                this.dialogInsertMockFormVisible = true
                this.isUpdateButton = 1
                this.addForm = {
                    interfaceName: '',
                    address: '',
                    method: [],
                    requestType: [],
                    responseType: '',
                    response: ''
                }
            },
            showUpdateDialog(interfaceId){
                this.isUpdateButton = 2

                axios.request({
                    url: '/interface/'+interfaceId,
                    method: 'GET',
                    params: {}
                }).then(response => {
                    this.dialogInsertMockFormVisible = true
                    this.addForm = {
                        interfaceId: response.data.interfaceId,
                        interfaceName: response.data.interfaceName,
                        address: response.data.urlPath,
                        method: response.data.requestMethod.split(','),
                        requestType: response.data.requestContextType.split(','),
                        responseType: response.data.responseContextType,
                        response: response.data.responseBody
                    }
                })
            },
            showInfoDialog(interfaceId){
                axios.request({
                    url: '/interface/'+interfaceId,
                    method: 'GET',
                    params: {}
                }).then(response => {
                    this.dialogMockInfoFormVisible = true
                    this.mockInfo = {
                        interfaceName: response.data.interfaceName,
                        address: response.data.urlPath,
                        method: response.data.requestMethod.split(','),
                        requestType: response.data.requestContextType.split(','),
                        responseType: response.data.responseContextType,
                        response: response.data.responseBody
                    }
                })
                axios.request({
                    url: '/interface/log/'+interfaceId,
                    method: 'GET',
                    params: {}
                }).then(response => {
                    this.dialogMockInfoFormVisible = true
                    const logList = []
                    response.data.forEach(info => {
                        logList.push({
                            "id": info.logId,
                            "callDate": info.callDate,
                            "callerIp": info.callerIp
                        })
                    })
                    this.callLogData = logList
                })
            },
            addMockerInfo(){
                axios.request({
                    url: '/interface',
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: {
                        'interfaceName':this.addForm.interfaceName,
                        'urlPath':this.addForm.address,
                        'requestMethod':this.addForm.method,
                        'requestContextType':this.addForm.requestType,
                        'responseBody':this.addForm.response,
                        'responseContextType':this.addForm.responseType,
                    }
                }).then(response => {
                    this.dialogInsertMockFormVisible = false
                    this.qryMockList()
                })
            },
            updateMockerInfo(){
                axios.request({
                    url: '/interface/'+this.addForm.interfaceId,
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: {
                        'interfaceName':this.addForm.interfaceName,
                        'urlPath':this.addForm.address,
                        'requestMethod':this.addForm.method,
                        'requestContextType':this.addForm.requestType,
                        'responseBody':this.addForm.response,
                        'responseContextType':this.addForm.responseType,
                    }
                }).then(response => {
                    this.dialogInsertMockFormVisible = false
                    this.qryMockList()
                })
            },
            deleteMockerInfo(interfaceId){
                axios.request({
                    url: '/interface/'+interfaceId,
                    method: 'DELETE',
                    params: {}
                }).then(response => {
                    this.qryMockList()
                })
            }

        }

    })

</script>
</html>